<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">


  <title>AZV</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker3.css" rel="stylesheet" />
  <link href="css/azv.css" rel="stylesheet">
  <link href="css/font-awesome.css" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>

  <nav class="navbar navbar-fixed-top navbar-top">
    <div class="col-xs-2 col-md-1 text-center footer-margin-top">
      <a class="navbar-brand" href="#">
        <img src="img/azv_logo.jpeg" class="img-logo" alt="">
      </a>
    </div>
    <div class="col-xs-2 col-md-1 pull-left footer-margin-top">
      <a href="contact.html"><i class="fa top-fa-address-card azv-padding navbar-icon-first"></i></a>
    </div>
    <div class="col-xs-4 col-md-4 pull-left footer-margin-top ">
      <a href="home.html"><i class="glyphicon top-glyphicon-home azv-padding-home navbar-icon"></i></a>
    </div>
    <div class="col-xs-3 col-md-6 footer-margin-top pull-right">
      <a href="rating.html" class="pull-right"><i class="fa page-fa-star-half-o margin-page"></i><b class="navbar-page">Rating<b></a>
    </div>
  </nav>
  <br>
  <div class="container-fluid">
    <div class="row-fluid top">
      <div class="col-md-6 col-md-offset-3">
        <div class="card azv-card">
          <div class="card-body">

            <h5 class='azv-blue'><b>Informacion di usuario</b></h5>
            <hr class='azv-hr'>

            <div class="form-group">
              <label class="control-label col-xs-6 align-left">AZV Nr.</label>
              <div class="col-xs-6">
                <input type="text" class="form-control" id="azvNr" name="azvNr" placeholder="1000002">
              </div>
            </div>
            <br>
            <br>
            <br>
            <div class="form-group">
              <label class="control-label col-xs-6 align-left">Fecha di naciemento</label>
              <div class="col-xs-6 date">
                <div class="input-group input-append date datepicker">
                  <input type="text" class="form-control" id="dob" name="dob" data_value='' placeholder="12/29/2018"
                    value="" />
                  <span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"></span></span>
                </div>
              </div>
            </div>
          </div>
          <br>
          <br>
          <h5 class='azv-blue'><b>Preguntanan general</b></h5>
          <hr class='azv-hr'>
          <div class="form-group">
            <label class="control-label col-xs-6 align-left">Fecha ultimo Bishita na dokter di cas:</label>
            <div class="col-xs-6 date">
              <div class="input-group input-append date datepicker">
                <input type="text" class="form-control" name="last_visit" id="last_visit" data_value='' placeholder="12/29/2018"
                  value="" />
                <span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"></span></span>
              </div>
            </div>
          </div>
          </br>
          </br>
          </br>
          </br>
          <div id="questions"></div>
          <button id="btn_rating" type="button" class="btn btn-lg btn-info btn-block" disabled>
            <span>Rating Done</span>
          </button>
          <hr>
          <br>
          <br>
          <!-- </form> -->
        </div>
      </div>
    </div>
    <nav class="navbar navbar-fixed-bottom navbar-bottom">
      <div class="col-xs-4 col-md-4 text-center footer-margin-top">
        <a href="home.html"><i class="glyphicon bottom-glyphicon-home"></i></a>
      </div>
      <div class="col-xs-4 col-md-4 text-center footer-margin-top">
        <a href="rating.html"><i class="fa bottom-fa-star-half-o"></i></a>
      </div>
      <div class="col-xs-4 col-md-4 text-center footer-margin-top">
        <a href="contact.html"><i class="fa bottom-fa-address-card"></i></a>
      </div>
    </nav>
  </div> <!-- /container -->
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/jquery.js"></script>
  <script src="js/jquery.cookie.min.js"></script>

  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js"></script>
  <script src="js/js.cookie.js"></script>
  <script>

    var test_data = "";
    var total_controls = 1;
    var answer_selected = 0;

    $.ajax({
      type: 'GET',
      url: 'js/DefQuestionAZV.json',
      ContentType: "application/json",
      async: false,
      success: function (response) {
        test_data = response;
      }
    });

    $(document).ready(function () {
      azv_rating_list_ok(test_data);


      // azv_rating_list();

      /* 1. Visualizing things on Hover - See next part for action on click */
      $('#stars li').on('mouseover', function () {
        var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

        // Now highlight all the stars that's not after the current hovered star
        $(this).parent().children('li.star').each(function (e) {
          if (e < onStar) {
            $(this).addClass('hover');
          }
          else {
            $(this).removeClass('hover');
          }
        });

      }).on('mouseout', function () {
        $(this).parent().children('li.star').each(function (e) {
          $(this).removeClass('hover');
        });
      });


      /* 2. Action to perform on click */
      $('#stars li').on('click', function () {

        var onStar = parseInt($(this).data('value'), 10); // The star currently selected
        var stars = $(this).parent().children('li.star');

        for (i = 0; i < stars.length; i++) {
          $(stars[i]).removeClass('selected');
        }

        for (i = 0; i < onStar; i++) {
          $(stars[i]).addClass('selected');
        }

        // JUST RESPONSE (Not needed)
        var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
        var msg = "";
        if (ratingValue > 1) {
          msg = "Thanks! You rated this " + ratingValue + " stars.";
        }
        else {
          msg = "We will improve ourselves. You rated this " + ratingValue + " stars.";
        }
        responseMessage(msg);

        $('#' + $(this).attr('lnk') + '').text($(this).attr('Title'));

        if ($(this).parent().attr('data_value') == '') {
          answer_selected++;
        }

        $(this).parent().attr('data_value', onStar);

        if (answer_selected >= total_controls) {
          if ($('#dob').val() != '' && $('#last_visit').val() != '') {
            $("#btn_rating").prop("disabled", false);
          }
        }

      });

      $('input[control="opt_radio"]').change(function () {

        $('#rating_' + $(this).attr('question') + '').text($(this).val());

        if ($('#rating_' + $(this).attr('question') + '').attr('data_value') == '') {
          answer_selected++;
        }
        $('#rating_' + $(this).attr('question') + '').attr('data_value', $(this).attr('question'));

        if (answer_selected >= total_controls) {
          if ($('#dob').val() != '' && $('#last_visit').val() != '') {
            $("#btn_rating").prop("disabled", false);
          }
        }
      });

      $('textarea').change(function () {

        if ($(this).val() != '') {

          $('#rating_' + $(this).attr('question') + '').text($(this).val());

          if ($('#rating_' + $(this).attr('question') + '').attr('data_value') == '') {
            answer_selected++;
          }
          $('#rating_' + $(this).attr('question') + '').attr('data_value', $(this).attr('question'));

          if (answer_selected >= total_controls) {
            if ($('#dob').val() != '' && $('#last_visit').val() != '') {
              $("#btn_rating").prop("disabled", false);
            }
          }
        }
        else {
          $('#rating_' + $(this).attr('question') + '').attr('data_value', '');
          answer_selected--;
        }

      });

      $('#azvNr').change(function () {
        if ($(this).val() != '') {
          answer_selected++;
        }
        else {
          answer_selected--;
        }
        if (answer_selected >= total_controls) {
          if ($('#dob').val() != '' && $('#last_visit').val() != '') {
            $("#btn_rating").prop("disabled", false);
          }
        }

      });
      $('#birthDatedate').change(function () {
        if ($(this).val() != '') {
          if (answer_selected >= total_controls) {
            $("#btn_rating").prop("disabled", false);
          }
        }
      });

      $('#last_visit').change(function () {
        if ($(this).val() != '') {
          if (answer_selected >= total_controls) {
            $("#btn_rating").prop("disabled", false);
          }
        }
      });



      $('#btn_rating').click(function (e) {

        // Get all values from controls

        var json_general_value = '';
        var json_questions_value = '';
        var general_index = 0;


        json_general_value = '{ "azv_number": "' + $('#azvNr').val() + '", "azv_dob": "' + $('#dob').val() + '","azv_last_visit": "' + $('#last_visit').val() + '",';
        json_questions_value = ' "azv_rating":{'

        $('.rating-control').each(function (index, value) {
          if (index != 0) {
            json_questions_value += ',';
          }
          json_questions_value += '"' + $(this).children().attr('question') + '": "' + $('#rating_' + $(this).children().attr('data_value') + '').text() + '"';

        });


        json_general_value += json_questions_value + '} } ';

        if ($('#azvNr').val() != '' && $('#dob').val() != '' && $('#date').val() != '')
          rating_create(json_general_value);
        else
          alert('Please complete the fields');

      });
      // alert(json_value);

    });

    function azv_rating_list() {
      // loader();
      $method = 'GET';
      $url = server + 'rating';
      $.ajax({
        type: $method,
        url: $url,
        ContentType: "application/json",
        headers: {
        },
        success: function (data) {
          azv_rating_list_ok(data);
        },
        error: function (data) {
          azv_rating_list_error(data);
        }
      });

    }

    function azv_rating_list_ok(data) {

      // data = jQuery.parseJSON(data);
      var html_questions = '';

      var data_length = data.length;
      if (data_length > 0) {

        $.each(data, function (i, item) {
          total_controls++;
          html_questions = '<div class="row azv-row">';

          switch (item.type) {
            case "radio":

              html_questions += '<div class="form-group">';
              html_questions += '<div class="text-center rating-radio rating-control">';
              html_questions += '<h5 question="Question ' + (i + 1) + '" id="' + (i + 1) + '" data_value=""><b>' + (i + 1) + '. ' + item.questions + '</b></h5>';

              $.each(item.extras.options, function (x, option) {
                html_questions += '<label class="radio-inline container">' + option + '<input type="radio" value ="' + option + '" control="opt_radio" name="question_' + (i + 1) + '"  question="' + (i + 1) + '"><span class="checkmark"></span></label>';
              });
              html_questions += '<label class="hidden" id="rating_' + (i + 1) + '" data_value=""></label>';
              html_questions += '</div>';
              html_questions += '</div>';
              break;

            case 'date':
              html_questions += '<div class="form-group">';
              html_questions += '<label class="control-label col-xs-12 text-center">' + (i + 1) + '. ' + item.questions + '?</label>';
              html_questions += '<div class="col-xs-8 col-xs-offset-2 date">';
              html_questions += '<div class="input-group input-append date datepicker rating-control">';
              html_questions += '<input type="text" class="form-control" name="question_' + (i + 1) + '" placeholder="12/29/2018" value="" />';
              html_questions += '<span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"></span></span>';
              html_questions += '</div>';
              html_questions += '</div>';
              html_questions += '</div>';
              break;
            case 'text':
              html_questions += '<div class="form-group">';
              html_questions += '<label class="control-label col-xs-12 text-center">' + (i + 1) + '. ' + item.questions + '?</label>';
              html_questions += '<div class=" col-xs-offset-1 col-xs-10">';
              html_questions += '<div class="input-group input-append rating-control">';
              html_questions += '<textarea question="' + (i + 1) + '" data_value="" type="text" class="form-control" rows="3" cols="50" name="question_' + (i + 1) + '" placeholder="" value=""></textarea>';
              html_questions += '</div>';
              html_questions += '<input class="hidden" id="rating_' + (i + 1) + '" data_value=""></input>';
              html_questions += '</div>';
              html_questions += '</div>';

              break;
            case 'rating':
              var nr = (i + 1);
              html_questions += '<div class="form-group">';
              html_questions += '<div class="text-center">';
              html_questions += '<h5><b>' + (i + 1) + '. ' + item.questions + '</b></h5>';
              html_questions += '<div class="rating-stars text-center rating-control">';
              html_questions += '<ul id="stars" question="Question ' + (i + 1) + '" data_value="">';
              $.each(item.extras.options, function (x, option) {
                html_questions += '<li class="star" title="' + option + '" lnk="rating_' + (i + 1) + '" data-value="' + (x + 1) + '">';
                html_questions += '<i class="fa fa-star fa-fw"></i>';
                html_questions += '</li>';
              });
              html_questions += '</ul>';
              html_questions += '</div>';
              html_questions += '<label id="rating_' + (i + 1) + '"></label>';
              html_questions += '</div>';
              html_questions += '</div>';
              break;
          }

          html_questions += '</div>';
          html_questions += '<hr class="azv-hr">';


          $('#questions').append(html_questions);
          html_questions = '';

        });
      }
    }

    function responseMessage(msg) {
      $('.success-box').fadeIn(200);
      $('.success-box div.text-message').html("<span>" + msg + "</span>");
    }

    function rating_create(json_value) {

      $method = 'POST';
      $url = server + 'rating'
      $.ajax({

        type: $method,
        url: $url,
        ContentType: "application/json",
        data: json_value,
        headers: {
          'Content-Type' : 'application/json'
        },
        success: function (data) {

          rating_create_ok(data);
        },
        error: function (data) {
          rating_create_error(data);
        }

      });

    }

    function rating_create_ok(data) {
      window.location.href = 'home.html';
    }

    function rating_create_error(data) {
      console.log(data);
    }

  </script>
  <script src="js/azv.js"></script>